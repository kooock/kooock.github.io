---
layout: post
title: "[알고리즘 트레이딩2: 금융 투자 리스크 정리] 1장 난제풀이"
excerpt: "알고리즘 트레이딩2: 금융 투자 리스크 chapter1(brain teaser)."
modified: 2018-07-23
comments: true
category : FinanceEngineering
tags: [금융공학, 퀀트, 알고리즘트레이딩, 리스크관리]
---


알고리즘 트레이딩2: 금융 투자 리스크 제 1장 개요
--------------------------------------------------------------------------------------------

#### 1.2 몇가지의 난제

##### 문제 1. 
    동전 게임이 있다고 가정한다. 그런데 다음의 두 가지 룰이 있다고 할 때에 
    안정된 투자를 선호하는 관점에서는 어떤 쪽의 룰을 선택하게 되겠는가? 
    먼저 어떤 룰에 따라서 플레이 하든지  지불해야 하는 비용은 동일하고, 동전의
    앞면과 뒷면이 나올 확률은 각각 0.5(50%)가 된다고 가정한다.

룰 a. 동전을 던져서 앞면이 나오면 $10, 뒷면이 나오면 $0의 수익을 얻는다. 10번 던져서 수익의 합을 받는다.

룰 b. 동전을 던져서 앞면이 나오면 $1, 뒷면이 나오면 $0의 수익을 얻는다. 100번 던져서 수익의 합을 받는다.

확률의 결과가 둘중에 하나가 될 경우 이항확률분포를 이용하면 확률적 특정과 기대값을 얻을 수 있다.

$$N$$번 시행한 경우 앞면이 나올 확률이 p일때 기대값은 $$Np$$이고 이것을 수익의 기대값으로 변환하려면 한번 앞면이 나왔을떄의 수익을 곱하주면 된다.

룰 a. 의 경우는 $$ 10 \times 0.5 \times 10 = 50$$\$

룰 b. 의 경우는 $$ 1 \times 0.5 \times 100 = 50$$\$

두 경우 동일한 기대값을 가지므로 아직 어느 것을 선택할 수 없다. 


어번에는 이항확률분포를 이용해서 표준편차를 계산한다.

동전 앞면이 나오는 횟수의 표준편차는 $$\sqrt{Np(1-p)}$$ 이고 수익의 표준편차는 여기에 수익을 곱해주면 된다.

룰 a. 의 경우 수익의 표준편차는 $$10 \times \sqrt{10 \times 0.5 \times 0.5} = 15.8$$\$

룰 b. 의 경우 수익의 표준편차는 $$1 \times \sqrt{100 \times 0.5 \times 0.5} = 5$$\$

동일한 평균 수익을 기대할 때에는 수익에 대한 리스크가 적은 쪽을 선호하게 된다. 

리스크 : 불확실성 또는 변동성 \>> 표준편차로 수치화 가능

그러므로 표준편차가 적은 b를 선택해야 한다.

##### 문제 2.

    동전을 던져서 앞면이 나오면 수익을 얻게 된다. 그렌데 여기에서는 플레이어가
    베팅한 금액에 비례해서 수익을 지불한다고 가정한다. 앞면이 나오면 배팅금액x5의 
    수익을 얻게 된다. 하지만 뒷면이 나오면 배팅금액을 잃게 된다. 매번 결과에 따라 
    수익 배분을 한다고 가정한다.
    
초기 자본을 $$x_{0}$$으로 표기하고 $$N$$번의 플레이를 한다고 가정한다.

어떤 전략으로 플레이해야 가장 큰 수익을 낼 수 있는가?


먼저 매 회 자본금 전부를 배팅하는 전략을 취해보자

계속해서 앞면이 나와서 5의 배수로 따고 있더라도 0.5의 확률로 뒷면이 한번이라도 나오게 되면 모든 수익을 다 잃는다.
그야말로 최악의 전략이다.


그렇다면 매회 배팅금액을 자본금의 일부로 한정해야 한다. 혹시 손실이 발생하더라도 플레이가 지속적으로 가능하고 손실 만회가 가능하기 때문이다. 

배팅금액을 $$ax_{0}$$라고 해보자 $$x_{0}$$는 자본금이며, $$a$$는 자본금의 일부를 나타내는 비율로 0~1사이의 값이다.

그렇다면 최상의 $$a$$는 얼마일까?

만약 앞면이 나왔다면 기대수익은 $$\begin{matrix} x_{1} &=& 5ax_{0} + (1-a)x_{0} \\ &=& (1+4a)x_{0} \end{matrix}$$

반대로 뒷면이 나왔다면 남은 자본금은 $$x_{1} = (1-a)x_{0}$$

확률적으로 앞면과 뒷면이 나오는 기대값은 각각 $$N \over 2$$,$$N \over 2$$ 이다. 

그렇다면 앞면만 나와서 얻게되는 금액은 $$x_{N \over 2} = (1+4a)^{N \over 2}x_{0}$$이고,

뒷면만 나와서 남게되는 금액은 $$x_{N \over 2} = (1-a)^{N \over 2}x_{0}$$ 이다. 

이렇다면 이 둘을 곱하면 완전하게 N번을 던졌을때의 기대수익을 구할 수 있다.(확률에서 연속시행의 확률값은 곱해야 한다.)

$$x_{N} = (1+4a)^{N \over 2}(1-a)^{N \over 2}x_{0}$$

여기서 소리지르면서 도망가긴 이르다. 아직 우리 $$a$$를 구하지 않았다.

자 이걸 그래프로 그리면 이렇게 생겨먹었다. 
(그래프 그리는 코드는 [이곳](https://github.com/kooock/kooock.github.io/blob/master/script/python/graph.py)
)


![useful image]({{ site.url }}/assets/images/brain_teaser2_graph.png)

눈썰미가 있는 사람들은 벌써 눈치 깠을 것이다. 

그렇다 이 그래프는 그 유멍한 이항분포인 베르누이 분포의 그것과 같다.

[Bernoulli Distribution](https://ko.wikipedia.org/wiki/%EB%B2%A0%EB%A5%B4%EB%88%84%EC%9D%B4_%EB%B6%84%ED%8F%AC)

최고점을 찾기위해 미분을 해줘야 한다. 그리고 기울기가 0이되는 값 중 조건에 만족하는 값만 찾으면 된다.


$$\begin{matrix} {dx_{N} \over da} 
&=& {d \over da}(1+4a)^{N \over 2}(1-a)^{N \over 2}x_{0} \\
&=& {d \over da}((1+4a)(1-a))^{N \over 2}x_{0} \\
&=& {N \over 2}((1+4a)(1-a))^{ {N \over 2}-1}{d \over da}(1+4a)(1-a)x_{0} \\
&=& {N \over 2}((1+4a)(1-a))^{ {N \over 2}-1}((1+4a){d(1-a) \over da}+(1-a){d(1+4a) \over da})x_{0} \\
&=& {N \over 2}((1+4a)(1-a))^{ {N \over 2}-1}(-(1+4a)+4(1-a))x_{0} \\
&=& {N \over 2}((1+4a)(1-a))^{ {N \over 2}-1}(-8a+3)x_{0}
\end{matrix}$$

뭔가 아직도 복잡하다 기분탓이려니 해라 

미분값을 0으로 만드는 $$a$$는 $$1+4a = 0$$ 이거나 $$1-a = 0$$ 또는 $$-8a+3 =0 $$를 만족하는 $$a$$이다.

와 이렇게만 해줘도 상당히 심플해졌다.

각각의 $$a$$는 $$a = -{1 \over 4}$$ 또는 $$a = 1$$ 또는 $$a = {3 \over 8}$$이 된다.

자 하나씩 보겠다. 

우선 첫번째 a는 탈락이다. a는 0부터 1사이의 값이기 때문이다. 

두번째 a도 탈락이다. 1은 100%를 뜻하며 전액 다 배팅을 한 것이 최악의 결과를 낳는 다는건 아까 봤기 때문이다.

그렇다면 세번째 a는? 0~1사이이며, 매 배팅마다 전부 다 꼴아박~~지호~~지도 않는다. 그

그렇다 우리가 그토록 찾던 배팅비율 a는 $$3 \over 8$$인 것이다.

그렇다면 기대수익은 어떻게 될까? $$x_{N} = (1+4a)^{N \over 2}(1-a)^{N \over 2}x_{0}$$ 이 식에 넣어보면 나온다.

$$\begin{matrix} x_{N} 
&=& (1+(4 \times {3 \over 8}))^{N \over 2}(1-{3 \over 8})^{N \over 2}x_{0} \\
&=& (1+{3 \over 2})^{N \over 2} \times {5 \over 8}^{N \over 2}x_{0} \\
&=& {5 \over 2}^{N \over 2} \times {5 \over 8}^{N \over 2}x_{0} \\
&=& ({5 \over 2} \times {5 \over 8})^{N \over 2}x_{0} \\
&=& {25 \over 16}^{N \over 2}x_{0} \\
&=& {5 \over 4}^{{2}^{N \over 2}}x_{0} \\ 
&=& {5 \over 4}^{2 \times {N \over 2} }x_{0} \\
&=& {5 \over 4}^{N}x_{0}
\end{matrix}$$

$$ 5 \over 4$$ 그러니까 125%씩 자본이 증가하는 것을 기대할 수 있다.






